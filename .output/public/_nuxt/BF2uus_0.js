import{_ as O}from"./CyeEiYbI.js";import{_ as b}from"./DyabKexD.js";import{_ as k}from"./BwUjpYiu.js";import{e as v,f as x,P as T,c as n,b as l,t as p,F as g,w as d,g as m,o,a as s,h as $,v as w,d as N,r as S}from"./BpnP_1c4.js";import{u as C}from"./BIUpqFe3.js";import{u as P}from"./BRJawhm2.js";import{_ as I}from"./DlAUqK2U.js";import"./Dvi7YPqy.js";import"./FoZdgCff.js";import"./BIYn82lU.js";const M=v({name:"PipelineDetail",data(){return{pipeline:null,loading:!0,error:"",testInput:"{}",running:!1,testOutput:null}},computed:{testOutputText(){return this.testOutput===null?"":typeof this.testOutput=="string"?this.testOutput:JSON.stringify(this.testOutput,null,2)}},setup(){const{apiFetch:t,apiUrl:e,environment:r}=C(),{mockMode:a}=P();return{apiFetch:t,apiUrl:e,environment:r,mockMode:a}},async mounted(){await this.load()},methods:{async load(){this.loading=!0,this.error="";const t=(this._.provides[T]||this.$route).params.id;try{this.pipeline=await this.apiFetch(`/api/pipelines/${t}`)}catch(e){this.error=e.message||"Failed to load pipeline"}finally{this.loading=!1}},async runTest(){if(!this.pipeline)return;let t;try{t=this.testInput.trim()?JSON.parse(this.testInput):{}}catch{this.testOutput={error:"Invalid JSON in input"};return}this.running=!0,this.testOutput=null;try{if(this.mockMode?.value){await new Promise(c=>setTimeout(c,400)),this.testOutput={result:"Mock pipeline output",input:t};return}const a=`${(x().public.apiUrl||"http://localhost:4000").replace(/\/$/,"")}/v1/pipelines/${this.pipeline.id}/invoke`,i=await $fetch(a,{method:"POST",body:t,credentials:"include",headers:{"Content-Type":"application/json","X-Environment":this.environment?.value??"production"}});this.testOutput=i.error?{error:i.error,output:i.output,steps:i.steps}:i.output}catch(e){const r=e;this.testOutput=r.data??e.message}finally{this.running=!1}}}}),A={class:"app-page"},F={key:0,class:"text-muted-foreground text-sm"},V={key:1,class:"app-error"},B={key:0,class:"mt-4 rounded bg-muted/50 p-3"},J={class:"text-xs overflow-auto max-h-[300px]"},R={class:"space-y-2 text-sm"},D={class:"text-muted-foreground"},E={class:"font-medium"},U={class:"text-muted-foreground"},H={key:0,class:"text-muted-foreground text-sm"};function L(t,e,r,a,i,c){const _=O,y=b,h=k;return o(),n("div",A,[l(_,{title:t.pipeline?.name??"Pipeline",description:"Edit and test run.","back-to":"/app/pipelines","back-label":"Pipelines"},null,8,["title"]),t.loading?(o(),n("p",F,"Loading…")):t.error?(o(),n("p",V,p(t.error),1)):t.pipeline?(o(),n(g,{key:2},[l(h,{class:"mb-4"},{default:d(()=>[e[2]||(e[2]=s("h3",{class:"app-section-title mb-2"},"Test run",-1)),e[3]||(e[3]=s("p",{class:"text-sm text-muted-foreground mb-2"},"Send sample input (JSON) and see the output.",-1)),$(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=u=>t.testInput=u),class:"app-input min-h-[100px] font-mono text-sm mb-2",placeholder:'{"query": "Hello"}'},null,512),[[w,t.testInput]]),l(y,{disabled:t.running,onClick:t.runTest},{default:d(()=>[N(p(t.running?"Running…":"Run pipeline"),1)]),_:1},8,["disabled","onClick"]),t.testOutput!==null?(o(),n("div",B,[e[1]||(e[1]=s("p",{class:"text-sm font-medium mb-2"},"Output",-1)),s("pre",J,p(t.testOutputText),1)])):m("",!0)]),_:1}),l(h,null,{default:d(()=>[e[4]||(e[4]=s("h3",{class:"app-section-title mb-2"},"Steps",-1)),s("ul",R,[(o(!0),n(g,null,S(t.pipeline.steps,(u,f)=>(o(),n("li",{key:f,class:"flex gap-2"},[s("span",D,p(f+1)+".",1),s("span",E,p(u.name),1),s("span",U,"("+p(u.type)+")",1)]))),128))]),t.pipeline.steps?.length?m("",!0):(o(),n("p",H,"No steps."))]),_:1})],64)):m("",!0)])}const tt=I(M,[["render",L]]);export{tt as default};
