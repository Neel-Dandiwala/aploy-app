{"file":"_id_-D5dmGHNJ.js","mappings":"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","names":["input","_ssrRenderAttrs","_mergeProps","_ssrRenderComponent","_withCtx","_push","_parent","_ssrRenderClass","_ssrInterpolate","_","_scopeId","_createVNode","_createTextVNode","_toDisplayString","_createBlock","_createCommentVNode","_openBlock"],"sources":["../../../../pages/app/knowledge-bases/[id].vue"],"sourcesContent":["<template>\n  <div class=\"app-page\">\n    <AppPageHeader\n      :title=\"kb?.name ?? 'Knowledge base'\"\n      description=\"Status and ingestion. Run ingest to sync from source or upload files.\"\n      back-to=\"/app/knowledge-bases\"\n      back-label=\"Knowledge bases\"\n    />\n    <p v-if=\"loading\" class=\"text-muted-foreground text-sm\">Loading…</p>\n    <p v-else-if=\"error\" class=\"app-error\">{{ error }}</p>\n    <template v-else-if=\"kb\">\n      <AppCard class=\"mb-4\">\n        <h3 class=\"app-section-title mb-2\">Overview</h3>\n        <p class=\"text-sm text-muted-foreground\">\n          Status: <span :class=\"statusClass\">{{ kb.status }}</span>\n          · Chunks: {{ kb.chunk_count ?? '—' }}\n        </p>\n        <p v-if=\"kb.error_message\" class=\"text-sm text-destructive mt-1\">{{ kb.error_message }}</p>\n        <p class=\"text-sm text-muted-foreground mt-1\">\n          Source: {{ sourceLabel }} · Embedding: {{ kb.embedding_model ?? 'text-embedding-3-small' }}\n        </p>\n        <div class=\"mt-4 flex flex-wrap gap-3\">\n          <div v-if=\"kb.source?.type === 'upload'\" class=\"flex flex-wrap items-center gap-2\">\n            <input\n              ref=\"fileInput\"\n              type=\"file\"\n              multiple\n              accept=\".pdf,.html,.htm,.md,.txt,text/plain,text/html,text/markdown,application/pdf\"\n              class=\"text-sm text-muted-foreground file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:bg-muted file:text-foreground\"\n              @change=\"onFileSelect\"\n            />\n            <AppButton :disabled=\"ingesting || !selectedFiles.length\" @click=\"runIngestWithFiles\">\n              {{ ingesting ? 'Ingesting…' : 'Upload & ingest' }}\n            </AppButton>\n          </div>\n          <AppButton\n            v-else\n            :disabled=\"ingesting\"\n            @click=\"runIngest\"\n          >\n            {{ ingesting ? 'Ingesting…' : 'Run ingest' }}\n          </AppButton>\n        </div>\n      </AppCard>\n      <AppCard>\n        <h3 class=\"app-section-title mb-2\">Config</h3>\n        <ul class=\"space-y-1 text-sm text-muted-foreground\">\n          <li>Chunk size: {{ kb.chunk_config?.size ?? 512 }} · Overlap: {{ kb.chunk_config?.overlap ?? 64 }}</li>\n          <li>Dimension: {{ kb.embedding_dimension ?? 1536 }}</li>\n        </ul>\n      </AppCard>\n    </template>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\ndefinePageMeta({ layout: 'app' })\n\ninterface KBDetail {\n  id: string\n  name: string\n  status: string\n  chunk_count?: number | null\n  error_message?: string | null\n  source?: { type?: string; bucket?: string; prefix?: string }\n  embedding_model?: string\n  embedding_dimension?: number\n  chunk_config?: { size?: number; overlap?: number }\n}\n\nexport default defineComponent({\n  name: 'KnowledgeBaseDetail',\n  data() {\n    return {\n      kb: null as KBDetail | null,\n      loading: true,\n      error: '',\n      ingesting: false,\n      selectedFiles: [] as File[],\n    }\n  },\n  computed: {\n    sourceLabel(): string {\n      if (!this.kb?.source) return 'Upload'\n      const s = this.kb.source\n      if (s.type === 's3') return `S3 ${s.bucket || ''} ${s.prefix || ''}`.trim()\n      if (s.type === 'gcs') return `GCS ${s.bucket || ''} ${s.prefix || ''}`.trim()\n      return String(s.type || 'upload')\n    },\n    statusClass(): string {\n      if (!this.kb) return ''\n      if (this.kb.status === 'ready') return 'text-emerald-600'\n      if (this.kb.status === 'failed') return 'text-destructive'\n      return 'text-amber-600'\n    },\n  },\n  setup() {\n    const { apiFetch, apiUrl } = useAployApi()\n    const { environment } = useEnvironment()\n    const { mockMode } = useMockMode()\n    return { apiFetch, apiUrl, environment, mockMode }\n  },\n  async mounted() {\n    await this.load()\n  },\n  methods: {\n    onFileSelect(e: Event) {\n      const input = e.target as HTMLInputElement\n      this.selectedFiles = input?.files ? Array.from(input.files) : []\n    },\n    async load() {\n      this.loading = true\n      this.error = ''\n      const id = (this.$route.params as { id: string }).id\n      try {\n        this.kb = await this.apiFetch<KBDetail>(`/api/knowledge-bases/${id}`)\n      } catch (e) {\n        this.error = (e as Error).message || 'Failed to load knowledge base'\n      } finally {\n        this.loading = false\n      }\n    },\n    async runIngest() {\n      if (!this.kb) return\n      this.ingesting = true\n      try {\n        await this.apiFetch<{ status: string; chunk_count: number }>(`/api/knowledge-bases/${this.kb.id}/ingest`, { method: 'POST' })\n        await this.load()\n      } catch (e) {\n        this.error = (e as Error).message || 'Ingestion failed'\n      } finally {\n        this.ingesting = false\n      }\n    },\n    async runIngestWithFiles() {\n      if (!this.kb || !this.selectedFiles.length) return\n      this.ingesting = true\n      try {\n        if (this.mockMode?.value) {\n          await new Promise((r) => setTimeout(r, 500))\n          this.selectedFiles = []\n          const input = this.$refs.fileInput as HTMLInputElement | undefined\n          if (input) input.value = ''\n          await this.load()\n          return\n        }\n        const config = useRuntimeConfig()\n        const base = (config.public.apiUrl as string) || 'http://localhost:4000'\n        const url = `${base.replace(/\\/$/, '')}/api/knowledge-bases/${this.kb.id}/ingest`\n        const form = new FormData()\n        for (const f of this.selectedFiles) form.append('files', f)\n        await $fetch(url, {\n          method: 'POST',\n          body: form,\n          credentials: 'include',\n          headers: { 'X-Environment': this.environment?.value ?? 'production' },\n        })\n        this.selectedFiles = []\n        const input = this.$refs.fileInput as HTMLInputElement | undefined\n        if (input) input.value = ''\n        await this.load()\n      } catch (e) {\n        this.error = (e as Error).message || 'Ingestion failed'\n      } finally {\n        this.ingesting = false\n      }\n    },\n  },\n})\n</script>\n"],"version":3}