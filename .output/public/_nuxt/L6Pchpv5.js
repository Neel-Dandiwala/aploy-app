import{_ as c}from"./Dvi7YPqy.js";import{e as f,n as r,f as u,c as s,F as m,a,h as p,v as g,j as h,d as i,b as x,w as k,o}from"./BpnP_1c4.js";import{_ as b}from"./DlAUqK2U.js";const y=f({name:"AuthCallbackPage",layout:"blank",data(){return{status:"loading",mfaToken:""}},mounted(){this.checkAuth()},methods:{async checkAuth(){const t=u().public.apiUrl;try{if((await $fetch(`${t}/auth/me`,{credentials:"include"})).mfaEnabled){this.status="mfa_required";return}this.status="done",await r("/app",{replace:!0})}catch{this.status="error"}},async submitMfa(){const t=u().public.apiUrl;try{await $fetch(`${t}/auth/mfa/check`,{method:"POST",credentials:"include",body:{token:this.mfaToken}}),await r("/app",{replace:!0})}catch{this.status="error"}}}}),w={class:"min-h-screen flex flex-col items-center justify-center gap-6 p-8 bg-surface"},T={key:0,class:"text-muted-foreground"},v={key:2,class:"text-destructive text-sm"},$={key:3,class:"text-muted-foreground text-sm"};function M(e,t,l,U,V,A){const d=c;return o(),s("div",w,[e.status==="loading"?(o(),s("p",T,"Signing you in...")):e.status==="mfa_required"?(o(),s(m,{key:1},[t[3]||(t[3]=a("h2",{class:"text-xl font-semibold text-zinc-900"},"Two-factor authentication",-1)),t[4]||(t[4]=a("p",{class:"text-muted-foreground text-sm"},"Enter the code from your authenticator app.",-1)),a("form",{onSubmit:t[1]||(t[1]=h((...n)=>e.submitMfa&&e.submitMfa(...n),["prevent"])),class:"flex flex-col gap-4 w-64"},[p(a("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>e.mfaToken=n),type:"text",placeholder:"000000",class:"app-input w-full text-center text-lg tracking-widest",maxlength:"6"},null,512),[[g,e.mfaToken]]),t[2]||(t[2]=a("button",{type:"submit",class:"rounded-app bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-hover transition-colors"}," Verify ",-1))],32)],64)):e.status==="error"?(o(),s("p",v,[t[6]||(t[6]=i(" Auth failed. ",-1)),x(d,{to:"/login",class:"underline"},{default:k(()=>[...t[5]||(t[5]=[i("Try again",-1)])]),_:1}),t[7]||(t[7]=i(". ",-1))])):(o(),s("p",$,"Redirecting..."))])}const B=b(y,[["render",M]]);export{B as default};
