{"version":3,"file":"new-DdaWsMTd.js","sources":["../../../../pages/app/pipelines/new.vue"],"sourcesContent":["<template>\n  <div class=\"app-page-narrow\">\n    <AppPageHeader\n      title=\"New pipeline\"\n      description=\"Add steps: retrieve (knowledge base), model (deployment), or HTTP. Order defines execution.\"\n      back-to=\"/app/pipelines\"\n      back-label=\"Pipelines\"\n    />\n    <form @submit.prevent=\"onSubmit\" class=\"space-y-6\">\n      <div>\n        <label class=\"app-label\">Name</label>\n        <input v-model=\"form.name\" class=\"app-input\" placeholder=\"e.g. Summarize then classify\" />\n      </div>\n      <div>\n        <label class=\"app-label\">Description (optional)</label>\n        <input v-model=\"form.description\" class=\"app-input\" placeholder=\"Short description\" />\n      </div>\n      <div>\n        <label class=\"app-label\">Steps</label>\n        <div v-for=\"(step, i) in form.steps\" :key=\"i\" class=\"mb-4 rounded border border-border/50 p-3 space-y-2\">\n          <div class=\"flex justify-between items-center\">\n            <span class=\"font-medium text-sm\">Step {{ i + 1 }}</span>\n            <button type=\"button\" class=\"text-destructive text-sm hover:underline\" @click=\"removeStep(i)\">Remove</button>\n          </div>\n          <div>\n            <label class=\"app-label text-xs\">Type</label>\n            <select v-model=\"step.type\" class=\"app-select\">\n              <option value=\"retrieve\">Retrieve (knowledge base)</option>\n              <option value=\"model\">Model (deployment)</option>\n              <option value=\"http\">HTTP request</option>\n            </select>\n          </div>\n          <div>\n            <label class=\"app-label text-xs\">Name (id)</label>\n            <input v-model=\"step.name\" class=\"app-input\" placeholder=\"e.g. step1\" />\n          </div>\n          <template v-if=\"step.type === 'retrieve'\">\n            <div>\n              <label class=\"app-label text-xs\">Knowledge base</label>\n              <select v-model=\"step.knowledgeBaseId\" class=\"app-select\">\n                <option value=\"\">Select knowledge base</option>\n                <option v-for=\"kb in knowledgeBases\" :key=\"kb.id\" :value=\"kb.id\">{{ kb.name }}</option>\n              </select>\n            </div>\n            <div>\n              <label class=\"app-label text-xs\">Top K</label>\n              <input v-model.number=\"step.topK\" type=\"number\" min=\"1\" max=\"100\" class=\"app-input\" placeholder=\"5\" />\n            </div>\n            <div>\n              <label class=\"app-label text-xs\">Query mapping (optional, default $.input.query)</label>\n              <input v-model=\"step.queryMapping\" class=\"app-input font-mono text-xs\" placeholder=\"$.input.query\" />\n            </div>\n          </template>\n          <template v-else-if=\"step.type === 'model'\">\n            <div>\n              <label class=\"app-label text-xs\">Deployment</label>\n              <select v-model=\"step.deploymentId\" class=\"app-select\">\n                <option value=\"\">Select deployment</option>\n                <option v-for=\"d in deployments\" :key=\"d.id\" :value=\"d.id\">{{ d.id }} — {{ d.model_version_id }}</option>\n              </select>\n            </div>\n            <div>\n              <label class=\"app-label text-xs\">Input mapping (optional) e.g. {\"messages\": \"$.input\"}</label>\n              <input v-model=\"step.inputMappingStr\" class=\"app-input font-mono text-xs\" placeholder='{\"messages\": \"$.input\"}'>\n            </div>\n          </template>\n          <template v-else>\n            <div>\n              <label class=\"app-label text-xs\">URL</label>\n              <input v-model=\"step.url\" class=\"app-input\" placeholder=\"https://...\" />\n            </div>\n            <div>\n              <label class=\"app-label text-xs\">Method</label>\n              <select v-model=\"step.method\" class=\"app-select\">\n                <option value=\"GET\">GET</option>\n                <option value=\"POST\">POST</option>\n              </select>\n            </div>\n          </template>\n          <div v-if=\"i > 0\">\n            <label class=\"app-label text-xs\">Depends on (step name, comma-separated)</label>\n            <input v-model=\"step.dependsOnStr\" class=\"app-input text-xs\" placeholder=\"step1\" />\n          </div>\n        </div>\n        <AppButton type=\"button\" variant=\"secondary\" class=\"mt-2\" @click=\"addStep\">Add step</AppButton>\n      </div>\n      <p v-if=\"error\" class=\"app-error\">{{ error }}</p>\n      <div class=\"flex gap-3\">\n        <AppButton type=\"submit\" :disabled=\"loading\">{{ loading ? 'Creating…' : 'Create pipeline' }}</AppButton>\n        <AppButton variant=\"secondary\" to=\"/app/pipelines\">Cancel</AppButton>\n      </div>\n    </form>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\ndefinePageMeta({ layout: 'app' })\n\ninterface DeploymentItem { id: string; model_version_id: string }\ninterface KnowledgeBaseItem { id: string; name: string }\n\ninterface StepForm {\n  type: 'model' | 'http' | 'retrieve'\n  name: string\n  deploymentId?: string\n  inputMappingStr?: string\n  knowledgeBaseId?: string\n  topK?: number\n  queryMapping?: string\n  url?: string\n  method?: string\n  dependsOnStr?: string\n}\n\nexport default defineComponent({\n  name: 'NewPipeline',\n  data() {\n    return {\n      form: {\n        name: '',\n        description: '',\n        steps: [] as StepForm[],\n      },\n      deployments: [] as DeploymentItem[],\n      knowledgeBases: [] as KnowledgeBaseItem[],\n      loading: false,\n      error: '',\n    }\n  },\n  setup() {\n    const { apiFetch } = useAployApi()\n    return { apiFetch }\n  },\n  async mounted() {\n    try {\n      const data = await this.apiFetch<{ deployments: DeploymentItem[] }>('/api/deploy')\n      this.deployments = data.deployments || []\n    } catch {\n      this.deployments = []\n    }\n    try {\n      const kbData = await this.apiFetch<{ knowledge_bases: KnowledgeBaseItem[] }>('/api/knowledge-bases')\n      this.knowledgeBases = kbData.knowledge_bases || []\n    } catch {\n      this.knowledgeBases = []\n    }\n  },\n  methods: {\n    addStep() {\n      this.form.steps.push({\n        type: 'model',\n        name: `step${this.form.steps.length + 1}`,\n        deploymentId: '',\n        method: 'POST',\n        topK: 5,\n      })\n    },\n    removeStep(i: number) {\n      this.form.steps.splice(i, 1)\n    },\n    buildSteps() {\n      return this.form.steps.map((s) => {\n        const step: Record<string, unknown> = {\n          id: s.name,\n          type: s.type,\n          name: s.name,\n        }\n        if (s.type === 'retrieve') {\n          step.knowledgeBaseId = s.knowledgeBaseId || undefined\n          step.topK = s.topK ?? 5\n          if (s.queryMapping?.trim()) step.queryMapping = s.queryMapping.trim()\n        } else if (s.type === 'model') {\n          step.deploymentId = s.deploymentId || undefined\n          if (s.inputMappingStr?.trim()) {\n            try {\n              step.inputMapping = JSON.parse(s.inputMappingStr)\n            } catch {}\n          }\n        } else {\n          step.url = s.url\n          step.method = s.method || 'GET'\n        }\n        if (s.dependsOnStr?.trim()) {\n          step.dependsOn = s.dependsOnStr.split(',').map((x) => x.trim()).filter(Boolean)\n        }\n        return step\n      })\n    },\n    async onSubmit() {\n      this.error = ''\n      this.loading = true\n      try {\n        const data = await this.apiFetch<{ id: string }>('/api/pipelines', {\n          method: 'POST',\n          body: {\n            name: this.form.name || 'Untitled pipeline',\n            description: this.form.description,\n            steps: this.buildSteps(),\n          },\n        })\n        await navigateTo(`/app/pipelines/${data.id}`)\n      } catch (e) {\n        this.error = (e as Error).message || 'Failed to create pipeline'\n      } finally {\n        this.loading = false\n      }\n    },\n  },\n})\n</script>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","_ssrInterpolate","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual","_ssrRenderList","_push","_parent"],"mappings":";;;;;;;;;;;;;;;;;;;;AAoHA,MAAA,YAAe,gBAAgB;AAAA,EAC7B,MAAM;AAAA,EACN,OAAO;AACL,WAAO;AAAA,MACL,MAAM;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,OAAO,CAAA;AAAA,MAAC;AAAA,MAEV,aAAa,CAAA;AAAA,MACb,gBAAgB,CAAA;AAAA,MAChB,SAAS;AAAA,MACT,OAAO;AAAA,IAAA;AAAA,EAEX;AAAA,EACA,QAAQ;AACN,UAAM,EAAE,SAAA,IAAa,YAAA;AACrB,WAAO,EAAE,SAAA;AAAA,EACX;AAAA,EACA,MAAM,UAAU;AACd,QAAI;AACF,YAAM,OAAO,MAAM,KAAK,SAA4C,aAAa;AACjF,WAAK,cAAc,KAAK,eAAe,CAAA;AAAA,IACzC,QAAQ;AACN,WAAK,cAAc,CAAA;AAAA,IACrB;AACA,QAAI;AACF,YAAM,SAAS,MAAM,KAAK,SAAmD,sBAAsB;AACnG,WAAK,iBAAiB,OAAO,mBAAmB,CAAA;AAAA,IAClD,QAAQ;AACN,WAAK,iBAAiB,CAAA;AAAA,IACxB;AAAA,EACF;AAAA,EACA,SAAS;AAAA,IACP,UAAU;AACR,WAAK,KAAK,MAAM,KAAK;AAAA,QACnB,MAAM;AAAA,QACN,MAAM,OAAO,KAAK,KAAK,MAAM,SAAS,CAAC;AAAA,QACvC,cAAc;AAAA,QACd,QAAQ;AAAA,QACR,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAAA,IACA,WAAW,GAAW;AACpB,WAAK,KAAK,MAAM,OAAO,GAAG,CAAC;AAAA,IAC7B;AAAA,IACA,aAAa;AACX,aAAO,KAAK,KAAK,MAAM,IAAI,CAAC,MAAM;AAChC,cAAM,OAAgC;AAAA,UACpC,IAAI,EAAE;AAAA,UACN,MAAM,EAAE;AAAA,UACR,MAAM,EAAE;AAAA,QAAA;AAEV,YAAI,EAAE,SAAS,YAAY;AACzB,eAAK,kBAAkB,EAAE,mBAAmB;AAC5C,eAAK,OAAO,EAAE,QAAQ;AACtB,cAAI,EAAE,cAAc,KAAA,QAAa,eAAe,EAAE,aAAa,KAAA;AAAA,QACjE,WAAW,EAAE,SAAS,SAAS;AAC7B,eAAK,eAAe,EAAE,gBAAgB;AACtC,cAAI,EAAE,iBAAiB,QAAQ;AAC7B,gBAAI;AACF,mBAAK,eAAe,KAAK,MAAM,EAAE,eAAe;AAAA,YAClD,QAAQ;AAAA,YAAC;AAAA,UACX;AAAA,QACF,OAAO;AACL,eAAK,MAAM,EAAE;AACb,eAAK,SAAS,EAAE,UAAU;AAAA,QAC5B;AACA,YAAI,EAAE,cAAc,QAAQ;AAC1B,eAAK,YAAY,EAAE,aAAa,MAAM,GAAG,EAAE,IAAI,CAAC,MAAM,EAAE,KAAA,CAAM,EAAE,OAAO,OAAO;AAAA,QAChF;AACA,eAAO;AAAA,MACT,CAAC;AAAA,IACH;AAAA,IACA,MAAM,WAAW;AACf,WAAK,QAAQ;AACb,WAAK,UAAU;AACf,UAAI;AACF,cAAM,OAAO,MAAM,KAAK,SAAyB,kBAAkB;AAAA,UACjE,QAAQ;AAAA,UACR,MAAM;AAAA,YACJ,MAAM,KAAK,KAAK,QAAQ;AAAA,YACxB,aAAa,KAAK,KAAK;AAAA,YACvB,OAAO,KAAK,WAAA;AAAA,UAAW;AAAA,QACzB,CACD;AACD,cAAM,WAAW,kBAAkB,KAAK,EAAE,EAAE;AAAA,MAC9C,SAAS,GAAG;AACV,aAAK,QAAS,EAAY,WAAW;AAAA,MACvC,UAAA;AACE,aAAK,UAAU;AAAA,MACjB;AAAA,IACF;AAAA,EAAA;AAEJ,CAAC;;;;AAjNM,QAAA,OAAAA,eAAAC,WAAA,EAAA,OAAM,qBAAiB,MAAA,CAAA,CAAA,GAAA;;IAExB,OAAM;AAAA,IACN,aAAY;AAAA,IACZ,WAAQ;AAAA,IACR,cAAW;AAAA,EAAA,GAAA,MAAA,OAAA,CAAA;0GAKO,KAAA,KAAK,IAAI,CAAA,yIAAAC,cAAA,SAIT,KAAA,KAAK,WAAW,CAAA,8GAAA;gBAIP,KAAA,KAAK,OAAK,CAAtB,MAAM,MAAC;AAE0B,UAAA,yJAAAC,eAAA,IAAC,CAAA,CAAA,2MAAAC,sBAAA,MAAA,QAK1B,KAAK,IAAI,IAAAC,gBAAT,KAAK,MAAI,UAAA,IAAAC,cAAT,KAAK,MAAI,UAAA,CAAA,IAAA,cAAA,EAAA,2DAAAF,sBAAA,MAAA,QAAT,KAAK,IAAI,IAAAC,gBAAT,KAAK,MAAI,OAAA,IAAAC,cAAT,KAAK,MAAI,OAAA,CAAA,IAAA,cAAA,EAAA,mDAAAF,sBAAA,MAAA,QAAT,KAAK,IAAI,IAAAC,gBAAT,KAAK,MAAI,MAAA,IAAAC,cAAT,KAAK,MAAI,MAAA,CAAA,IAAA,cAAA,EAAA,qGAAAJ,cAAA,SAQV,KAAK,IAAI,CAAA,oDAAA;AAEX,QAAA,KAAK,SAAI,YAAA;AAGJ,YAAA,kHAAAE,sBAAA,MAAA,QAAA,KAAK,eAAe,IAAAC,gBAApB,KAAK,iBAAe,EAAA,IAAAC,cAApB,KAAK,iBAAe,EAAA,CAAA,IAAA,cAAA,EAAA,yCAAA;AAEdC,oBAAA,KAAA,gBAAc,CAApB,OAAE;AAAkC,cAAA,UAAAL,cAAA,SAAO,GAAG,EAAE,CAAA,GAAAE,sBAAA,MAAA,QAFhD,KAAK,eAAe,oBAApB,KAAK,iBAEsC,GAAG,EAAE,kBAFhD,KAAK,iBAEsC,GAAG,EAAE,CAAA,IAAA,cAAA,EAAA,IAAAD,eAAK,GAAG,IAAI,CAAA,WAAA;AAAA;sHAKtD,KAAK,IAAI,CAAA,+KAAAD,cAAA,SAIhB,KAAK,YAAY,CAAA,iFAAA;AAAA,IAGhB,WAAA,KAAK,SAAI,SAAA;AAGT,YAAA,8GAAAE,sBAAA,MAAA,QAAA,KAAK,YAAY,IAAAC,gBAAjB,KAAK,cAAY,EAAA,IAAAC,cAAjB,KAAK,cAAY,EAAA,CAAA,IAAA,cAAA,EAAA,qCAAA;AAEZC,oBAAA,KAAA,aAAW,CAAhB,MAAC;sCAA8B,SAAO,EAAE,EAAE,CAAA,GAAAH,sBAAA,MAAA,QAF1C,KAAK,YAAY,IAAAC,gBAAjB,KAAK,cAEiC,EAAE,EAAE,kBAF1C,KAAK,cAEiC,EAAE,EAAE,CAAA,IAAA,cAAA,EAAA,IAAAF,eAAK,EAAE,EAAE,CAAA,MAAAA,eAAS,EAAE,gBAAgB,CAAA,WAAA;AAAA;AAK/E,YAAA,uJAAAD,cAAA,SAAA,KAAK,eAAe,CAAA,+GAAA;AAAA,IAAA,OAAA;AAMpB,YAAA,kEAAAA,cAAA,SAAA,KAAK,GAAG,CAAA,wJAAAE,sBAAA,MAAA,QAIP,KAAK,MAAM,IAAAC,gBAAX,KAAK,QAAM,KAAA,IAAAC,cAAX,KAAK,QAAM,KAAA,CAAA,IAAA,cAAA,EAAA,oCAAAF,sBAAA,MAAA,QAAX,KAAK,MAAM,IAAAC,gBAAX,KAAK,QAAM,MAAA,IAAAC,cAAX,KAAK,QAAM,MAAA,CAAA,IAAA,cAAA,EAAA,uCAAA;AAAA;QAMrB,IAAC,GAAA;AAEM,YAAA,8FAAAJ,cAAA,SAAA,KAAK,YAAY,CAAA,uDAAA;AAAA,IAAA,OAAA;;;;;;;IAG1B,MAAK;AAAA,IAAS,SAAQ;AAAA,IAAY,OAAM;AAAA,IAAQ,SAAO,KAAA;AAAA,EAAA,GAAA;AAAA,qBAAlE,CAA+F,GAAAM,QAAAC,UAAA,aAAA;;;;;0BAApB,UAAQ;AAAA,QAAA;AAAA;;;;;MAE5E,KAAA,OAAK;iDAAuB,KAAA,KAAK,CAAA,MAAA;AAAA,EAAA,OAAA;;;;;IAE7B,MAAK;AAAA,IAAU,UAAU,KAAA;AAAA,EAAA,GAAA;AAAA,qBAApC,CAAwG,GAAAD,QAAAC,UAAA,aAAA;;iCAAxD,KAAA,UAAO,cAAA,iBAAA,CAAA,EAAA;AAAA,MAAA,OAAA;;0CAAP,KAAA,UAAO,cAAA,iBAAA,GAAA,CAAA;AAAA,QAAA;AAAA;;;;;IAC5C,SAAQ;AAAA,IAAY,IAAG;AAAA,EAAA,GAAA;AAAA,qBAAlC,CAAqE,GAAAD,QAAAC,UAAA,aAAA;;;;;0BAAlB,QAAM;AAAA,QAAA;AAAA;;;;;;;;;;;;;"}