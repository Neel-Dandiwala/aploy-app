import{_ as k}from"./CyeEiYbI.js";import{_ as y}from"./DyabKexD.js";import{_}from"./BwUjpYiu.js";import{e as w,f as F,P as v,c as o,b as d,t as s,F as C,w as u,g as h,o as n,a as i,d as p,k as $,i as S}from"./BpnP_1c4.js";import{u as x}from"./BIUpqFe3.js";import{u as I}from"./FoZdgCff.js";import{u as A}from"./BRJawhm2.js";import{_ as B}from"./DlAUqK2U.js";import"./Dvi7YPqy.js";import"./BIYn82lU.js";const P=w({name:"KnowledgeBaseDetail",data(){return{kb:null,loading:!0,error:"",ingesting:!1,selectedFiles:[]}},computed:{sourceLabel(){if(!this.kb?.source)return"Upload";const e=this.kb.source;return e.type==="s3"?`S3 ${e.bucket||""} ${e.prefix||""}`.trim():e.type==="gcs"?`GCS ${e.bucket||""} ${e.prefix||""}`.trim():String(e.type||"upload")},statusClass(){return this.kb?this.kb.status==="ready"?"text-emerald-600":this.kb.status==="failed"?"text-destructive":"text-amber-600":""}},setup(){const{apiFetch:e,apiUrl:t}=x(),{environment:l}=I(),{mockMode:a}=A();return{apiFetch:e,apiUrl:t,environment:l,mockMode:a}},async mounted(){await this.load()},methods:{onFileSelect(e){const t=e.target;this.selectedFiles=t?.files?Array.from(t.files):[]},async load(){this.loading=!0,this.error="";const e=(this._.provides[v]||this.$route).params.id;try{this.kb=await this.apiFetch(`/api/knowledge-bases/${e}`)}catch(t){this.error=t.message||"Failed to load knowledge base"}finally{this.loading=!1}},async runIngest(){if(this.kb){this.ingesting=!0;try{await this.apiFetch(`/api/knowledge-bases/${this.kb.id}/ingest`,{method:"POST"}),await this.load()}catch(e){this.error=e.message||"Ingestion failed"}finally{this.ingesting=!1}}},async runIngestWithFiles(){if(!(!this.kb||!this.selectedFiles.length)){this.ingesting=!0;try{if(this.mockMode?.value){await new Promise(c=>setTimeout(c,500)),this.selectedFiles=[];const r=this.$refs.fileInput;r&&(r.value=""),await this.load();return}const l=`${(F().public.apiUrl||"http://localhost:4000").replace(/\/$/,"")}/api/knowledge-bases/${this.kb.id}/ingest`,a=new FormData;for(const r of this.selectedFiles)a.append("files",r);await $fetch(l,{method:"POST",body:a,credentials:"include",headers:{"X-Environment":this.environment?.value??"production"}}),this.selectedFiles=[];const m=this.$refs.fileInput;m&&(m.value=""),await this.load()}catch(e){this.error=e.message||"Ingestion failed"}finally{this.ingesting=!1}}}}}),D={class:"app-page"},E={key:0,class:"text-muted-foreground text-sm"},M={key:1,class:"app-error"},N={class:"text-sm text-muted-foreground"},O={key:0,class:"text-sm text-destructive mt-1"},R={class:"text-sm text-muted-foreground mt-1"},T={class:"mt-4 flex flex-wrap gap-3"},U={key:0,class:"flex flex-wrap items-center gap-2"},V={class:"space-y-1 text-sm text-muted-foreground"};function z(e,t,l,a,m,r){const c=k,f=y,g=_;return n(),o("div",D,[d(c,{title:e.kb?.name??"Knowledge base",description:"Status and ingestion. Run ingest to sync from source or upload files.","back-to":"/app/knowledge-bases","back-label":"Knowledge bases"},null,8,["title"]),e.loading?(n(),o("p",E,"Loading…")):e.error?(n(),o("p",M,s(e.error),1)):e.kb?(n(),o(C,{key:2},[d(g,{class:"mb-4"},{default:u(()=>[t[2]||(t[2]=i("h3",{class:"app-section-title mb-2"},"Overview",-1)),i("p",N,[t[1]||(t[1]=p(" Status: ",-1)),i("span",{class:$(e.statusClass)},s(e.kb.status),3),p(" · Chunks: "+s(e.kb.chunk_count??"—"),1)]),e.kb.error_message?(n(),o("p",O,s(e.kb.error_message),1)):h("",!0),i("p",R," Source: "+s(e.sourceLabel)+" · Embedding: "+s(e.kb.embedding_model??"text-embedding-3-small"),1),i("div",T,[e.kb.source?.type==="upload"?(n(),o("div",U,[i("input",{ref:"fileInput",type:"file",multiple:"",accept:".pdf,.html,.htm,.md,.txt,text/plain,text/html,text/markdown,application/pdf",class:"text-sm text-muted-foreground file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:bg-muted file:text-foreground",onChange:t[0]||(t[0]=(...b)=>e.onFileSelect&&e.onFileSelect(...b))},null,544),d(f,{disabled:e.ingesting||!e.selectedFiles.length,onClick:e.runIngestWithFiles},{default:u(()=>[p(s(e.ingesting?"Ingesting…":"Upload & ingest"),1)]),_:1},8,["disabled","onClick"])])):(n(),S(f,{key:1,disabled:e.ingesting,onClick:e.runIngest},{default:u(()=>[p(s(e.ingesting?"Ingesting…":"Run ingest"),1)]),_:1},8,["disabled","onClick"]))])]),_:1}),d(g,null,{default:u(()=>[t[3]||(t[3]=i("h3",{class:"app-section-title mb-2"},"Config",-1)),i("ul",V,[i("li",null,"Chunk size: "+s(e.kb.chunk_config?.size??512)+" · Overlap: "+s(e.kb.chunk_config?.overlap??64),1),i("li",null,"Dimension: "+s(e.kb.embedding_dimension??1536),1)])]),_:1})],64)):h("",!0)])}const Y=B(P,[["render",z]]);export{Y as default};
