import{_ as k}from"./DyabKexD.js";import{_ as w}from"./CyeEiYbI.js";import{_ as v}from"./BwUjpYiu.js";import{u as _}from"./BIUpqFe3.js";import{e as C,c as i,b as n,w as l,t as a,F as g,r as c,g as m,i as F,o as s,d as u,a as o,h as p,l as h,v as b}from"./BpnP_1c4.js";import{_ as T}from"./DlAUqK2U.js";import"./Dvi7YPqy.js";import"./FoZdgCff.js";import"./BRJawhm2.js";import"./BIYn82lU.js";const V=C({name:"TriggersList",data(){return{triggers:[],pipelines:[],loading:!0,error:"",showCreate:!1,creating:!1,createForm:{pipeline_id:"",name:"Webhook",type:"webhook",webhook_secret:""}}},setup(){const{apiFetch:e}=_();return{apiFetch:e}},async mounted(){await Promise.all([this.loadTriggers(),this.loadPipelines()])},methods:{async loadTriggers(){this.loading=!0,this.error="";try{const e=await this.apiFetch("/api/triggers");this.triggers=e.triggers||[]}catch(e){this.error=e.message||"Failed to load triggers"}finally{this.loading=!1}},async loadPipelines(){try{const e=await this.apiFetch("/api/pipelines");this.pipelines=e.pipelines||[]}catch{this.pipelines=[]}},async onCreate(){if(this.createForm.pipeline_id){this.creating=!0;try{await this.apiFetch("/api/triggers",{method:"POST",body:{pipeline_id:this.createForm.pipeline_id,name:this.createForm.name||"Webhook",type:this.createForm.type,webhook_secret:this.createForm.webhook_secret||void 0}}),this.showCreate=!1,this.createForm={pipeline_id:"",name:"Webhook",type:"webhook",webhook_secret:""},await this.loadTriggers()}catch(e){alert(e.message||"Create failed")}finally{this.creating=!1}}},async deleteTrigger(e){if(confirm("Delete this trigger?"))try{await this.apiFetch(`/api/triggers/${e}`,{method:"DELETE"}),await this.loadTriggers()}catch(t){alert(t.message||"Delete failed")}}}}),$={class:"app-page"},x={key:0,class:"text-muted-foreground text-sm"},P={key:1,class:"app-error"},W={key:2,class:"space-y-2"},D={class:"font-medium"},N={class:"text-muted-foreground text-sm ml-2"},S={class:"text-muted-foreground text-sm ml-2"},A={class:"flex items-center gap-2"},B={key:0,class:"text-xs bg-surface-overlay px-2 py-1 rounded break-all max-w-md text-zinc-800"},E=["onClick"],L={key:0,class:"text-muted-foreground text-sm"},U={class:"space-y-3"},M=["value"],j={class:"flex gap-2"};function z(e,t,H,O,X,Z){const d=k,f=w,y=v;return s(),i("div",$,[n(f,{title:"Triggers"},{actions:l(()=>[n(d,{onClick:t[0]||(t[0]=r=>e.showCreate=!0)},{default:l(()=>[...t[6]||(t[6]=[u("Create trigger",-1)])]),_:1})]),_:1}),e.loading?(s(),i("p",x,"Loading…")):e.error?(s(),i("p",P,a(e.error),1)):(s(),i("div",W,[(s(!0),i(g,null,c(e.triggers,r=>(s(),i("div",{key:r.id,class:"rounded border border-border/50 bg-muted/30 px-4 py-3 flex flex-wrap items-center justify-between gap-2"},[o("div",null,[o("span",D,a(r.name),1),o("span",N,a(r.type),1),o("span",S,"Pipeline "+a(r.pipeline_id),1)]),o("div",A,[r.webhook_url?(s(),i("code",B,a(r.webhook_url),1)):m("",!0),o("button",{type:"button",class:"text-destructive text-sm hover:underline",onClick:q=>e.deleteTrigger(r.id)},"Delete",8,E)])]))),128)),!e.loading&&!e.error&&e.triggers.length===0?(s(),i("p",L," No triggers. Create a webhook to run a pipeline from Zapier, cron, or your app. ")):m("",!0)])),e.showCreate?(s(),F(y,{key:3,class:"mt-6"},{default:l(()=>[t[14]||(t[14]=o("h3",{class:"app-section-title mb-3"},"Create trigger",-1)),o("div",U,[o("div",null,[t[8]||(t[8]=o("label",{class:"app-label"},"Pipeline",-1)),p(o("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>e.createForm.pipeline_id=r),class:"app-select"},[t[7]||(t[7]=o("option",{value:""},"Select pipeline",-1)),(s(!0),i(g,null,c(e.pipelines,r=>(s(),i("option",{key:r.id,value:r.id},a(r.name),9,M))),128))],512),[[h,e.createForm.pipeline_id]])]),o("div",null,[t[9]||(t[9]=o("label",{class:"app-label"},"Name",-1)),p(o("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>e.createForm.name=r),class:"app-input",placeholder:"Webhook"},null,512),[[b,e.createForm.name]])]),o("div",null,[t[11]||(t[11]=o("label",{class:"app-label"},"Type",-1)),p(o("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>e.createForm.type=r),class:"app-select"},[...t[10]||(t[10]=[o("option",{value:"webhook"},"Webhook",-1)])],512),[[h,e.createForm.type]])]),o("div",null,[t[12]||(t[12]=o("label",{class:"app-label"},"Webhook secret (optional)",-1)),p(o("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>e.createForm.webhook_secret=r),class:"app-input",type:"password",placeholder:"Set X-Webhook-Secret header"},null,512),[[b,e.createForm.webhook_secret]])]),o("div",j,[n(d,{disabled:e.creating,onClick:e.onCreate},{default:l(()=>[u(a(e.creating?"Creating…":"Create"),1)]),_:1},8,["disabled","onClick"]),n(d,{variant:"secondary",onClick:t[5]||(t[5]=r=>e.showCreate=!1)},{default:l(()=>[...t[13]||(t[13]=[u("Cancel",-1)])]),_:1})])])]),_:1})):m("",!0)])}const re=T(V,[["render",z]]);export{re as default};
