import{_ as c}from"./BK5343vK.js";import{e as f,n as r,f as l,c as s,F as p,a,h as m,v as g,i as h,d as i,b,w as x,o as n}from"./eG_W-IWR.js";import{_ as k}from"./DlAUqK2U.js";const y=f({name:"AuthCallbackPage",layout:"blank",data(){return{status:"loading",mfaToken:""}},mounted(){this.checkAuth()},methods:{async checkAuth(){const t=l().public.apiUrl;try{if((await $fetch(`${t}/auth/me`,{credentials:"include"})).mfaEnabled){this.status="mfa_required";return}this.status="done",await r("/app",{replace:!0})}catch{this.status="error"}},async submitMfa(){const t=l().public.apiUrl;try{await $fetch(`${t}/auth/mfa/check`,{method:"POST",credentials:"include",body:{token:this.mfaToken}}),await r("/app",{replace:!0})}catch{this.status="error"}}}}),w={class:"min-h-screen flex flex-col items-center justify-center gap-6 p-8 bg-[#0a0a0f]"},T={key:0,class:"text-zinc-400"},$={key:2,class:"text-red-400"},v={key:3,class:"text-zinc-400"};function z(e,t,u,M,U,V){const d=c;return n(),s("div",w,[e.status==="loading"?(n(),s("p",T,"Signing you in...")):e.status==="mfa_required"?(n(),s(p,{key:1},[t[3]||(t[3]=a("h2",{class:"text-xl font-semibold text-white"},"Two-factor authentication",-1)),t[4]||(t[4]=a("p",{class:"text-zinc-400"},"Enter the code from your authenticator app.",-1)),a("form",{onSubmit:t[1]||(t[1]=h((...o)=>e.submitMfa&&e.submitMfa(...o),["prevent"])),class:"flex flex-col gap-4 w-64"},[m(a("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>e.mfaToken=o),type:"text",placeholder:"000000",class:"w-full rounded-lg border border-zinc-600 bg-zinc-900 px-3 py-2 text-center text-lg tracking-widest text-zinc-100",maxlength:"6"},null,512),[[g,e.mfaToken]]),t[2]||(t[2]=a("button",{type:"submit",class:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500"}," Verify ",-1))],32)],64)):e.status==="error"?(n(),s("p",$,[t[6]||(t[6]=i(" Auth failed. ",-1)),b(d,{to:"/login",class:"underline"},{default:x(()=>[...t[5]||(t[5]=[i("Try again",-1)])]),_:1}),t[7]||(t[7]=i(". ",-1))])):(n(),s("p",v,"Redirecting..."))])}const _=k(y,[["render",z]]);export{_ as default};
