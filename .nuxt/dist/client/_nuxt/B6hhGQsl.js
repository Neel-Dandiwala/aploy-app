import{_ as c}from"./CyeEiYbI.js";import{_ as v}from"./DyabKexD.js";import{u as y}from"./BIUpqFe3.js";import{e as w,n as h,c as l,b as p,a,h as s,v as r,l as u,F as m,r as S,g as f,t as i,w as b,j as C,o as n,d as g}from"./BpnP_1c4.js";import{_ as T}from"./DlAUqK2U.js";import"./Dvi7YPqy.js";import"./FoZdgCff.js";import"./BRJawhm2.js";import"./BIYn82lU.js";const V=w({name:"NewKnowledgeBase",data(){return{form:{name:"",sourceType:"upload",credentialId:"",bucket:"",prefix:"",chunkSize:512,chunkOverlap:64},credentials:[],loading:!1,error:""}},setup(){const{apiFetch:e}=y();return{apiFetch:e}},async mounted(){try{const e=await this.apiFetch("/api/org/credentials");this.credentials=e.credentials||[]}catch{this.credentials=[]}},methods:{async onSubmit(){this.error="",this.loading=!0;try{const e={type:this.form.sourceType};(this.form.sourceType==="s3"||this.form.sourceType==="gcs")&&(e.bucket=this.form.bucket||void 0,e.prefix=this.form.prefix||void 0,this.form.credentialId&&(e.credentialId=this.form.credentialId));const o=await this.apiFetch("/api/knowledge-bases",{method:"POST",body:{name:this.form.name||"Untitled knowledge base",source:e,chunk_config:{size:this.form.chunkSize||512,overlap:this.form.chunkOverlap??64}}});await h(`/app/knowledge-bases/${o.id}`)}catch(e){this.error=e.message||"Failed to create knowledge base"}finally{this.loading=!1}}}}),U={class:"app-page-narrow"},N=["value"],z={key:0,class:"app-error"},B={class:"flex gap-3"};function F(e,o,I,A,O,$){const k=c,d=v;return n(),l("div",U,[p(k,{title:"New knowledge base",description:"Create a knowledge base. Add documents via ingest (upload files or S3/GCS).","back-to":"/app/knowledge-bases","back-label":"Knowledge bases"}),a("form",{onSubmit:o[7]||(o[7]=C((...t)=>e.onSubmit&&e.onSubmit(...t),["prevent"])),class:"space-y-6"},[a("div",null,[o[8]||(o[8]=a("label",{class:"app-label"},"Name",-1)),s(a("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.name=t),class:"app-input",placeholder:"e.g. Product docs"},null,512),[[r,e.form.name]])]),a("div",null,[o[12]||(o[12]=a("label",{class:"app-label"},"Source (for ingest without upload)",-1)),s(a("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.sourceType=t),class:"app-select"},[...o[9]||(o[9]=[a("option",{value:"upload"},"Upload (use ingest with files)",-1),a("option",{value:"s3"},"S3",-1),a("option",{value:"gcs"},"GCS",-1)])],512),[[u,e.form.sourceType]]),e.form.sourceType==="s3"||e.form.sourceType==="gcs"?(n(),l(m,{key:0},[o[11]||(o[11]=a("label",{class:"app-label mt-2"},"Credential",-1)),s(a("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.credentialId=t),class:"app-select"},[o[10]||(o[10]=a("option",{value:""},"Select credential",-1)),(n(!0),l(m,null,S(e.credentials,t=>(n(),l("option",{key:t.id,value:t.id},i(t.name)+" ("+i(t.type)+")",9,N))),128))],512),[[u,e.form.credentialId]]),s(a("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.bucket=t),class:"app-input mt-2",placeholder:"Bucket"},null,512),[[r,e.form.bucket]]),s(a("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.prefix=t),class:"app-input mt-2",placeholder:"Prefix (optional)"},null,512),[[r,e.form.prefix]])],64)):f("",!0)]),a("div",null,[o[13]||(o[13]=a("label",{class:"app-label"},"Chunk size",-1)),s(a("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>e.form.chunkSize=t),type:"number",min:"64",max:"2048",class:"app-input",placeholder:"512"},null,512),[[r,e.form.chunkSize,void 0,{number:!0}]])]),a("div",null,[o[14]||(o[14]=a("label",{class:"app-label"},"Chunk overlap",-1)),s(a("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>e.form.chunkOverlap=t),type:"number",min:"0",max:"512",class:"app-input",placeholder:"64"},null,512),[[r,e.form.chunkOverlap,void 0,{number:!0}]])]),e.error?(n(),l("p",z,i(e.error),1)):f("",!0),a("div",B,[p(d,{type:"submit",disabled:e.loading},{default:b(()=>[g(i(e.loading?"Creatingâ€¦":"Create knowledge base"),1)]),_:1},8,["disabled"]),p(d,{variant:"secondary",to:"/app/knowledge-bases"},{default:b(()=>[...o[15]||(o[15]=[g("Cancel",-1)])]),_:1})])],32)])}const q=T(V,[["render",F]]);export{q as default};
