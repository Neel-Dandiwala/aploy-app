{"version":3,"file":"callback-Rhv5kD-e.js","sources":["../../../../pages/auth/callback.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen flex flex-col items-center justify-center gap-6 p-8 bg-surface\">\n    <p v-if=\"status === 'loading'\" class=\"text-muted-foreground\">Signing you in...</p>\n    <template v-else-if=\"status === 'mfa_required'\">\n      <h2 class=\"text-xl font-semibold text-zinc-900\">Two-factor authentication</h2>\n      <p class=\"text-muted-foreground text-sm\">Enter the code from your authenticator app.</p>\n      <form @submit.prevent=\"submitMfa\" class=\"flex flex-col gap-4 w-64\">\n        <input\n          v-model=\"mfaToken\"\n          type=\"text\"\n          placeholder=\"000000\"\n          class=\"app-input w-full text-center text-lg tracking-widest\"\n          maxlength=\"6\"\n        />\n        <button type=\"submit\" class=\"rounded-app bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-hover transition-colors\">\n          Verify\n        </button>\n      </form>\n    </template>\n    <p v-else-if=\"status === 'error'\" class=\"text-destructive text-sm\">\n      Auth failed. <NuxtLink to=\"/login\" class=\"underline\">Try again</NuxtLink>.\n    </p>\n    <p v-else class=\"text-muted-foreground text-sm\">Redirecting...</p>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'AuthCallbackPage',\n  layout: 'blank',\n  data() {\n    return {\n      status: 'loading' as 'loading' | 'mfa_required' | 'done' | 'error',\n      mfaToken: '',\n    }\n  },\n  mounted() {\n    this.checkAuth()\n  },\n  methods: {\n    async checkAuth() {\n      const config = useRuntimeConfig()\n      const apiUrl = config.public.apiUrl as string\n      try {\n        const res = await $fetch<{ mfaEnabled?: boolean }>(`${apiUrl}/auth/me`, { credentials: 'include' })\n        if (res.mfaEnabled) {\n          this.status = 'mfa_required'\n          return\n        }\n        this.status = 'done'\n        await navigateTo('/app', { replace: true })\n      } catch {\n        this.status = 'error'\n      }\n    },\n    async submitMfa() {\n      const config = useRuntimeConfig()\n      const apiUrl = config.public.apiUrl as string\n      try {\n        await $fetch(`${apiUrl}/auth/mfa/check`, {\n          method: 'POST',\n          credentials: 'include',\n          body: { token: this.mfaToken },\n        })\n        await navigateTo('/app', { replace: true })\n      } catch {\n        this.status = 'error'\n      }\n    },\n  },\n})\n</script>\n"],"names":["_ssrRenderAttrs","_mergeProps","_push","_parent"],"mappings":";;;;;;;;;;;;;;AA6BA,MAAA,YAAe,gBAAgB;AAAA,EAC7B,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,OAAO;AACL,WAAO;AAAA,MACL,QAAQ;AAAA,MACR,UAAU;AAAA,IAAA;AAAA,EAEd;AAAA,EACA,UAAU;AACR,SAAK,UAAA;AAAA,EACP;AAAA,EACA,SAAS;AAAA,IACP,MAAM,YAAY;AAChB,YAAM,SAAS,iBAAA;AACf,YAAM,SAAS,OAAO,OAAO;AAC7B,UAAI;AACF,cAAM,MAAM,MAAM,OAAiC,GAAG,MAAM,YAAY,EAAE,aAAa,WAAW;AAClG,YAAI,IAAI,YAAY;AAClB,eAAK,SAAS;AACd;AAAA,QACF;AACA,aAAK,SAAS;AACd,cAAM,WAAW,QAAQ,EAAE,SAAS,MAAM;AAAA,MAC5C,QAAQ;AACN,aAAK,SAAS;AAAA,MAChB;AAAA,IACF;AAAA,IACA,MAAM,YAAY;AAChB,YAAM,SAAS,iBAAA;AACf,YAAM,SAAS,OAAO,OAAO;AAC7B,UAAI;AACF,cAAM,OAAO,GAAG,MAAM,mBAAmB;AAAA,UACvC,QAAQ;AAAA,UACR,aAAa;AAAA,UACb,MAAM,EAAE,OAAO,KAAK,SAAA;AAAA,QAAS,CAC9B;AACD,cAAM,WAAW,QAAQ,EAAE,SAAS,MAAM;AAAA,MAC5C,QAAQ;AACN,aAAK,SAAS;AAAA,MAChB;AAAA,IACF;AAAA,EAAA;AAEJ,CAAC;;;AAvEM,QAAA,OAAAA,eAAAC,WAAA,EAAA,OAAM,iFAA6E,MAAA,CAAA,CAAA,GAAA;MAC7E,KAAA,WAAM,WAAA;;aACM,KAAA,WAAM,gBAAA;+PAKZ,KAAA,QAAQ,CAAA,oRAAA;AAAA,EAAA,WAWT,KAAA,WAAM,SAAA;;;MACK,IAAG;AAAA,MAAS,OAAM;AAAA,IAAA,GAAA;AAAA,uBAA5B,CAA4D,GAAAC,QAAAC,UAAA,aAAA;;;;;4BAApB,WAAS;AAAA,UAAA;AAAA;;;;;;;;;;;;;;;;;"}