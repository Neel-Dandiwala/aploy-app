import{_ as k}from"./CyeEiYbI.js";import{_ as w}from"./DyabKexD.js";import{u as x}from"./BIUpqFe3.js";import{e as V,n as U,c as p,b as m,a as t,h as a,v as i,F as d,r as v,w as f,t as r,g as S,j as T,o as s,l as y,d as g}from"./BpnP_1c4.js";import{_ as M}from"./DlAUqK2U.js";import"./Dvi7YPqy.js";import"./FoZdgCff.js";import"./BRJawhm2.js";import"./BIYn82lU.js";const B=V({name:"NewPipeline",data(){return{form:{name:"",description:"",steps:[]},deployments:[],knowledgeBases:[],loading:!1,error:""}},setup(){const{apiFetch:l}=x();return{apiFetch:l}},async mounted(){try{const l=await this.apiFetch("/api/deploy");this.deployments=l.deployments||[]}catch{this.deployments=[]}try{const l=await this.apiFetch("/api/knowledge-bases");this.knowledgeBases=l.knowledge_bases||[]}catch{this.knowledgeBases=[]}},methods:{addStep(){this.form.steps.push({type:"model",name:`step${this.form.steps.length+1}`,deploymentId:"",method:"POST",topK:5})},removeStep(l){this.form.steps.splice(l,1)},buildSteps(){return this.form.steps.map(l=>{const e={id:l.name,type:l.type,name:l.name};if(l.type==="retrieve")e.knowledgeBaseId=l.knowledgeBaseId||void 0,e.topK=l.topK??5,l.queryMapping?.trim()&&(e.queryMapping=l.queryMapping.trim());else if(l.type==="model"){if(e.deploymentId=l.deploymentId||void 0,l.inputMappingStr?.trim())try{e.inputMapping=JSON.parse(l.inputMappingStr)}catch{}}else e.url=l.url,e.method=l.method||"GET";return l.dependsOnStr?.trim()&&(e.dependsOn=l.dependsOnStr.split(",").map(c=>c.trim()).filter(Boolean)),e})},async onSubmit(){this.error="",this.loading=!0;try{const l=await this.apiFetch("/api/pipelines",{method:"POST",body:{name:this.form.name||"Untitled pipeline",description:this.form.description,steps:this.buildSteps()}});await U(`/app/pipelines/${l.id}`)}catch(l){this.error=l.message||"Failed to create pipeline"}finally{this.loading=!1}}}}),O={class:"app-page-narrow"},$={class:"flex justify-between items-center"},C={class:"font-medium text-sm"},I=["onClick"],N=["onUpdate:modelValue"],P=["onUpdate:modelValue"],_=["onUpdate:modelValue"],q=["value"],F=["onUpdate:modelValue"],K=["onUpdate:modelValue"],A=["onUpdate:modelValue"],D=["value"],E=["onUpdate:modelValue"],G=["onUpdate:modelValue"],H=["onUpdate:modelValue"],R={key:3},j=["onUpdate:modelValue"],L={key:0,class:"app-error"},z={class:"flex gap-3"};function J(l,e,c,Q,W,X){const h=k,b=w;return s(),p("div",O,[m(h,{title:"New pipeline",description:"Add steps: retrieve (knowledge base), model (deployment), or HTTP. Order defines execution.","back-to":"/app/pipelines","back-label":"Pipelines"}),t("form",{onSubmit:e[2]||(e[2]=T((...n)=>l.onSubmit&&l.onSubmit(...n),["prevent"])),class:"space-y-6"},[t("div",null,[e[3]||(e[3]=t("label",{class:"app-label"},"Name",-1)),a(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>l.form.name=n),class:"app-input",placeholder:"e.g. Summarize then classify"},null,512),[[i,l.form.name]])]),t("div",null,[e[4]||(e[4]=t("label",{class:"app-label"},"Description (optional)",-1)),a(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.form.description=n),class:"app-input",placeholder:"Short description"},null,512),[[i,l.form.description]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"app-label"},"Steps",-1)),(s(!0),p(d,null,v(l.form.steps,(n,u)=>(s(),p("div",{key:u,class:"mb-4 rounded border border-border/50 p-3 space-y-2"},[t("div",$,[t("span",C,"Step "+r(u+1),1),t("button",{type:"button",class:"text-destructive text-sm hover:underline",onClick:o=>l.removeStep(u)},"Remove",8,I)]),t("div",null,[e[6]||(e[6]=t("label",{class:"app-label text-xs"},"Type",-1)),a(t("select",{"onUpdate:modelValue":o=>n.type=o,class:"app-select"},[...e[5]||(e[5]=[t("option",{value:"retrieve"},"Retrieve (knowledge base)",-1),t("option",{value:"model"},"Model (deployment)",-1),t("option",{value:"http"},"HTTP request",-1)])],8,N),[[y,n.type]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"app-label text-xs"},"Name (id)",-1)),a(t("input",{"onUpdate:modelValue":o=>n.name=o,class:"app-input",placeholder:"e.g. step1"},null,8,P),[[i,n.name]])]),n.type==="retrieve"?(s(),p(d,{key:0},[t("div",null,[e[9]||(e[9]=t("label",{class:"app-label text-xs"},"Knowledge base",-1)),a(t("select",{"onUpdate:modelValue":o=>n.knowledgeBaseId=o,class:"app-select"},[e[8]||(e[8]=t("option",{value:""},"Select knowledge base",-1)),(s(!0),p(d,null,v(l.knowledgeBases,o=>(s(),p("option",{key:o.id,value:o.id},r(o.name),9,q))),128))],8,_),[[y,n.knowledgeBaseId]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"app-label text-xs"},"Top K",-1)),a(t("input",{"onUpdate:modelValue":o=>n.topK=o,type:"number",min:"1",max:"100",class:"app-input",placeholder:"5"},null,8,F),[[i,n.topK,void 0,{number:!0}]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"app-label text-xs"},"Query mapping (optional, default $.input.query)",-1)),a(t("input",{"onUpdate:modelValue":o=>n.queryMapping=o,class:"app-input font-mono text-xs",placeholder:"$.input.query"},null,8,K),[[i,n.queryMapping]])])],64)):n.type==="model"?(s(),p(d,{key:1},[t("div",null,[e[13]||(e[13]=t("label",{class:"app-label text-xs"},"Deployment",-1)),a(t("select",{"onUpdate:modelValue":o=>n.deploymentId=o,class:"app-select"},[e[12]||(e[12]=t("option",{value:""},"Select deployment",-1)),(s(!0),p(d,null,v(l.deployments,o=>(s(),p("option",{key:o.id,value:o.id},r(o.id)+" — "+r(o.model_version_id),9,D))),128))],8,A),[[y,n.deploymentId]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"app-label text-xs"},'Input mapping (optional) e.g. {"messages": "$.input"}',-1)),a(t("input",{"onUpdate:modelValue":o=>n.inputMappingStr=o,class:"app-input font-mono text-xs",placeholder:'{"messages": "$.input"}'},null,8,E),[[i,n.inputMappingStr]])])],64)):(s(),p(d,{key:2},[t("div",null,[e[15]||(e[15]=t("label",{class:"app-label text-xs"},"URL",-1)),a(t("input",{"onUpdate:modelValue":o=>n.url=o,class:"app-input",placeholder:"https://..."},null,8,G),[[i,n.url]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"app-label text-xs"},"Method",-1)),a(t("select",{"onUpdate:modelValue":o=>n.method=o,class:"app-select"},[...e[16]||(e[16]=[t("option",{value:"GET"},"GET",-1),t("option",{value:"POST"},"POST",-1)])],8,H),[[y,n.method]])])],64)),u>0?(s(),p("div",R,[e[18]||(e[18]=t("label",{class:"app-label text-xs"},"Depends on (step name, comma-separated)",-1)),a(t("input",{"onUpdate:modelValue":o=>n.dependsOnStr=o,class:"app-input text-xs",placeholder:"step1"},null,8,j),[[i,n.dependsOnStr]])])):S("",!0)]))),128)),m(b,{type:"button",variant:"secondary",class:"mt-2",onClick:l.addStep},{default:f(()=>[...e[19]||(e[19]=[g("Add step",-1)])]),_:1},8,["onClick"])]),l.error?(s(),p("p",L,r(l.error),1)):S("",!0),t("div",z,[m(b,{type:"submit",disabled:l.loading},{default:f(()=>[g(r(l.loading?"Creating…":"Create pipeline"),1)]),_:1},8,["disabled"]),m(b,{variant:"secondary",to:"/app/pipelines"},{default:f(()=>[...e[21]||(e[21]=[g("Cancel",-1)])]),_:1})])],32)])}const se=M(B,[["render",J]]);export{se as default};
